{% extends 'layouts/basefile/base.html' %}
{% block content %}
{% load static %}

<!-- Start content -->
<div class="content">
    <div class="container-fluid">
        <div class="page-title-box">
            <div class="row align-items-center">
                <div class="col-sm-6">
                    <h4 class="page-title">SkipTrace</h4>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="javascript:void(0);"><i
                                    class="mdi mdi-home-outline"></i></a></li>
                        <li class="breadcrumb-item active">Single SkipTrace</li>
                    </ol>
                </div>
                <div class="col-sm-6">
                    <!--<a class="btn btn-primary waves-effect waves-light float-right" href="{% url 'upload_skip_trace' %}">-->
                        <!--<i class="fa fa-plus mr-2"></i> Bulk Trace-->
                    <!--</a>-->
                    <a data-toggle="tooltip" class="btn btn-primary waves-effect waves-light float-right "
                       {% if price_data > obj.amount %} data-original-title="You Don't have sufficient balance to use this feature!"
                        href="#" {% elif obj.amount < 20 %} data-original-title="You have less than $20 prepaid balance" href="{% url 'single_trace' %}" {% else %} href="{% url 'single_trace' %}" {% endif %}>
                        <i class="fa fa-search"></i> &nbsp; Skip Trace
                    </a>
                    <!--<a class="btn btn-primary waves-effect waves-light float-right mr-1" href="{% url 'skip_trace_existing' %}">-->
                        <!--<i class="fa fa-arrow-up"></i> Skip Trace Existing List-->
                    <!--</a>-->
                </div>
            </div> <!-- end row -->
        </div>
        <!-- end page-title -->

        <div class="row">
            <div class="col-md-12">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link"  href="{% url 'skip_trace' 'list' %}">
                            <i class="fas fa-upload  "></i> &nbsp;Bulk Skiptrace
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active"  href="{% url 'skip_trace' 'single' %}">
                            <i class="fab fa-searchengin "></i> &nbsp;Single Skiptrace
                        </a>
                    </li>

                    <li class="nav-item ml-auto">
                        <div class="input-group input-group-sm mb-0">
                            <h6 class="text-secondary">Balance : <span class="text-primary">${{ obj.amount }}</span></h6> &nbsp;
                          <!--<input id="add_balance" name="add_balance" required type="number" min="0" class="form-control border-primary" placeholder="Enter Balance" aria-label="Enter Balance" aria-describedby="basic-addon2">-->
                          <div class="input-group-append">
                              &nbsp;<button type="button" data-toggle="modal" data-target=".bs-example-modal-center" class="btn btn-primary waves-effect waves-light float-right add_balance_btn_color rounded">
                                    <i class="mdi mdi-plus"></i> Add Balance
                              </button>
                            <!--<button onclick="add_new_balance()" data-original-title="Add Balance in your Account" data-toggle="tooltip" class="btn btn-primary w-sm" type="button">Add Balance</button>-->
                          </div>
                        </div>
                        <form id="form_checkout" action="{% url 'small_plan' %}" method="post">{% csrf_token %}
                            <input hidden id="bal_id" name="bal_id" value="">
                            <input hidden id="where_to" name="where_to" value="bulk">
                        </form>
                    </li>

                </ul>

                <div id="my_modal" class="modal fade bs-example-modal-center" tabindex="-1" role="dialog"
                aria-labelledby="mySmallModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">

                        <div class="modal-header" style="color:#2e63b8;">
                            <h5 class="modal-title mt-0"> Add Wallet Balance</h5>
                            <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <form id="major_market_form">
                        <div class="modal-body">

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label>Amount</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">$</div>
                                            </div>
                                          <input value="100" id="add_balance" name="add_balance" required type="number" min="0" class="form-control border-primary" aria-label="Enter Balance" aria-describedby="basic-addon2">
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div><!-- /.modal-content -->
                            <div class="modal-footer">
                                    <div class="row">
                                        <div class="col-sm-12 ">
                                            <button id="pay_btn" onclick="add_new_balance()" data-original-title="Add Balance in your Account" data-toggle="tooltip" class="btn btn-primary btn-md btn-block" type="button">Continue</button>
                                        </div>
                                    </div>
                                </div>
                        </form>

                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </div>



                <div class="card">
                    <div class="card-body skiptrace_table_data">
                        <div class="">
                            <form method="post">{% csrf_token %}
                            <div id="filters-div" class="row mb-3">
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="control-label">Name:</label>
                                        <input autocomplete="off" class="form-control" id="file_name_search" name="file_name_search" type="text">
                                    </div>
                                </div>
<!--                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">-->
<!--                                    <div class="form-group mb-0">-->
<!--                                        <label class="control-label">Email Traced:</label>-->
<!--                                        <input autocomplete="off" class="form-control" id="email_search" name="email_search" type="email">-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">-->
<!--                                    <div class="form-group mb-0">-->
<!--                                        <label class="control-label">Phone Traced:</label>-->
<!--                                        <input type="text" id="phone-number-id"-->
<!--                                        name="phone-number-id"-->
<!--                                        class="form-control"/>-->
<!--                                        {% if form.phone.errors %}-->
<!--                                            <div class="text-danger">-->
<!--                                                {{ form.phone.errors | striptags }}-->
<!--                                            </div>-->
<!--                                        {% endif %}-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">-->
<!--                                    <div class="form-group mb-0">-->
<!--                                        <label class="control-label">Address Traced:</label>-->
<!--                                        <input autocomplete="off" class="form-control" id="address_search" name="address_search" type="text">-->
<!--                                    </div>-->
<!--                                </div>-->
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="control-label">Property Address:</label>
                                        <input autocomplete="off" class="form-control" id="property_address_search" name="property_address_search" type="text">
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="control-label">Property City:</label>
                                        <input autocomplete="off" class="form-control" id="property_city_search" name="property_city_search" type="text">
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="control-label">Property State:</label>
                                        <select id="property_state_search" name="property_state_search"
                                            class="select2 form-control"
                                                 data-placeholder="Choose ...">
                                          <option disabled selected>Select State</option>
                                          <option value="AL">Alabama</option>
                                          <option value="AK">Alaska</option>
                                          <option value="AZ">Arizona</option>
                                          <option value="AR">Arkansas</option>
                                          <option value="CA">California</option>
                                          <option value="CO">Colorado</option>
                                          <option value="CT">Connecticut</option>
                                          <option value="DE">Delaware</option>
                                          <option value="DC">District Of Columbia</option>
                                          <option value="FL">Florida</option>
                                          <option value="GA">Georgia</option>
                                          <option value="HI">Hawaii</option>
                                          <option value="ID">Idaho</option>
                                          <option value="IL">Illinois</option>
                                          <option value="IN">Indiana</option>
                                          <option value="IA">Iowa</option>
                                          <option value="KS">Kansas</option>
                                          <option value="KY">Kentucky</option>
                                          <option value="LA">Louisiana</option>
                                          <option value="ME">Maine</option>
                                          <option value="MD">Maryland</option>
                                          <option value="MA">Massachusetts</option>
                                          <option value="MI">Michigan</option>
                                          <option value="MN">Minnesota</option>
                                          <option value="MS">Mississippi</option>
                                          <option value="MO">Missouri</option>
                                          <option value="MT">Montana</option>
                                          <option value="NE">Nebraska</option>
                                          <option value="NV">Nevada</option>
                                          <option value="NH">New Hampshire</option>
                                          <option value="NJ">New Jersey</option>
                                          <option value="NM">New Mexico</option>
                                          <option value="NY">New York</option>
                                          <option value="NC">North Carolina</option>
                                          <option value="ND">North Dakota</option>
                                          <option value="OH">Ohio</option>
                                          <option value="OK">Oklahoma</option>
                                          <option value="OR">Oregon</option>
                                          <option value="PA">Pennsylvania</option>
                                          <option value="RI">Rhode Island</option>
                                          <option value="SC">South Carolina</option>
                                          <option value="SD">South Dakota</option>
                                          <option value="TN">Tennessee</option>
                                          <option value="TX">Texas</option>
                                          <option value="UT">Utah</option>
                                          <option value="VT">Vermont</option>
                                          <option value="VA">Virginia</option>
                                          <option value="WA">Washington</option>
                                          <option value="WV">West Virginia</option>
                                          <option value="WI">Wisconsin</option>
                                          <option value="WY">Wyoming</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group mb-0">
                                        <label class="control-label">Property Zip:</label>
                                        <input autocomplete="off" class="form-control" id="property_zip_search" name="property_zip_search" type="text">
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-4 mt-2 col-md-4">
                                    <div class="form-group">
                                        <br>
                                        <button class="btn btn-primary w-md waves-effect waves-light  mt-2 ml-10"
                                            type="submit">Search</button>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                        <input hidden id="user_id" name="user_id" value="{{ user.id }}" >
                        <table id="datatable-buttons" class="table table-hover dt-responsive nowrap"
                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>File Name</th>
                                    <th>Name</th>
                                    <th>Emails Traced</th>
                                    <th>Phones Traced</th>
                                    <th>Addresses Traced</th>
                                    <th>Property Address</th>
                                    <th>Property City</th>
                                    <th>Property State</th>
                                    <th>Property Zip</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for item in data %}
                                <tr>
                                    <td>{{ item.id }}</td>
                                    <td id="seq_td">
                                        <a class="btn btn-primary btn-sm btn-block btn_wrap_content" href="/{{ item.list_link }}"> {{ item.file_name }}
                                        </a>
                                    </td>
                                    <td>{{ item.full_name }}</td>
                                    <td class="single_skiptrace">
                                        <div>
                                            {{ item.email }} <br>
                                        </div>
                                    </td>
                                    <td class="single_skiptrace">

                                        <div>
                                            {{ item.phone }}
                                        </div>

                                    </td>
                                    <td class="single_skiptrace">
                                        <div>
                                            {{ item.address }}
                                        </div>
                                    </td>
                                    <td>{{ item.property_address }}</td>
                                    <td>{{ item.property_city }}</td>
                                    <td>{{ item.property_state }}</td>
                                    <td>{{ item.property_zip }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- end col -->
        </div> <!-- end row -->

    </div>
    <!-- container-fluid -->

</div>
<!-- content -->

{% block extrajs %}

<script type="text/javascript">
toastr.options = {
    "progressBar": true,
    "positionClass": "toast-bottom-right",
};

$('#my_modal').on('hidden.bs.modal', function () {
  $('#add_balance').val('100');
})

$(document).ready(function () {
    $('#phone-number-id').focus(function () {
        var mask = "999-999-9999";
        $(this).inputmask(mask, {"placeholder": ""});
    });
    $('#property_zip_search').focus(function () {
        var misk = "99999";
        $(this).inputmask(misk, {"placeholder": ""});
    });
});

function add_new_balance() {
if ($('#add_balance').val() < 10){
    toastr.error('Please Enter Amount equal to or more than $10!', 'Error');
    e.preventDefault();
}
else {
    $.ajax({
        type: 'POST',
        url: window.location.origin+"/skiptrace/add_payment",
        data:{
            balance: $('#add_balance').val(),
            user: $('#user_id').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success:function(data){
        var token = function(res){
            var $id = $('<input type=hidden name=stripeToken />').val(res.id);
            var $email = $('<input type=hidden name=stripeEmail />').val(res.email);
            $('#bal_id').val(data.response.balance);
            $('#form_checkout').append($id).append($email).submit();
        };
        StripeCheckout.open({
            key:data.response.key,
            amount:data.response.balance,
            name:'SkipTrace Checkout',
            token:token,
            email: data.response.email,
            allowRememberMe: false,
            });
        },
    });
}
}


function add_new_balance() {
if ($('#add_balance').val() < 10){
    toastr.error('Please Enter Amount equal to or more than $10!', 'Error');
    e.preventDefault();
}
else {

    $.ajax({
        type: 'POST',
        url: window.location.origin+"/skiptrace/add_payment",
        data:{
            balance: $('#add_balance').val(),
            user: $('#user_id').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },
        success:function(data){
        var token = function(res){
            var $id = $('<input type=hidden name=stripeToken />').val(res.id);
            var $email = $('<input type=hidden name=stripeEmail />').val(res.email);
            $('#bal_id').val(data.response.balance);
            $('#form_checkout').append($id).append($email).submit();
            $('#pay_btn').attr('disabled', 'true');
        };
        StripeCheckout.open({
            key:data.response.key,
            amount:data.response.balance,
            name:'SkipTrace Checkout',
            token:token,
            email: data.response.email,
            allowRememberMe: false,
            });
        },
    });
}
}

</script>
{% endblock %}



{% endblock %}